<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RBX Community</title>
</head>
<body>
<style>
*{box-sizing:border-box;user-select:none;outline:none;}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#121212;color:#fff;}
header{height:50px;display:flex;align-items:center;justify-content:space-between;background:#000;border-bottom:1px solid #2a2a2a;padding:0 12px;position:sticky;top:0;z-index:1000;}
.logo{height:36px;}
.header-right{display:flex;align-items:center;gap:12px;}
.profile{width:32px;height:32px;border-radius:50%;background-size:cover;background-position:center;cursor:pointer;border:2px solid #fff;transition:border-color 1s ease, background-image 1s ease, opacity 1s ease;opacity:1;}
.hamburger{width:32px;height:24px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;padding:2px;background:#000;border-radius:12px;box-shadow:2px 2px 6px rgba(0,0,0,0.5);transition: transform 0.2s;}
.hamburger div{height:4px;background:#fff;border-radius:6px;transition:all 0.3s ease;}
.hamburger.active div:nth-child(1){transform:rotate(45deg) translate(5px,5px);}
.hamburger.active div:nth-child(2){opacity:0;}
.hamburger.active div:nth-child(3){transform:rotate(-45deg) translate(5px,-5px);}
.menu-overlay{position:fixed;top:50px;left:0;width:100%;height:100vh;background:#000;overflow-y:auto;transform:translateY(-100%);transition:transform 0.3s ease;z-index:900;display:flex;flex-direction:column;align-items:center;padding-top:20px;}
.menu-overlay.active{transform:translateY(0);}
.menu-overlay a{color:#fff;text-decoration:none;font-size:20px;margin:12px 0;font-weight:bold;}
.menu-overlay a:hover{color:#ccc;}
main{padding:20px;min-height:200vh;}

/* Profile Panel */
.profile-panel{position:fixed;top:0;left:0;width:100%;height:100vh;background:#111;transform:translateX(100%);transition:transform 0.3s ease;z-index:1100;display:flex;flex-direction:column;}
.profile-panel.active{transform:translateX(0);}
.panel-header{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid #222;}
.close-btn{background:#ff3b30;color:#fff;padding:6px 16px;font-size:16px;font-weight:bold;border:none;border-radius:12px;cursor:pointer;transition:transform 0.2s;}
.close-btn:hover{transform:scale(1.05);}
.panel-top{display:flex;flex-direction:column;align-items:center;margin:20px 0;gap:12px;}
#panelProfilePic{width:100px;height:100px;border-radius:50%;border:3px solid #fff;background-size:cover;background-position:center;transition:border-color 1s ease, background-image 1s ease, opacity 1s ease;cursor:pointer;}
#userInfo{color:#fff;font-size:16px;display:flex;flex-direction:column;align-items:center;gap:6px;}
#copyLinkContainer{display:flex;align-items:center;gap:8px;width:90%;max-width:300px;}
#copyLinkContainer input{flex:1;padding:6px 12px;border-radius:12px;border:1px solid #333;background:#222;color:#fff;text-align:center;font-size:14px;}
#copyLinkContainer button{background:#4caf50;color:#fff;border:none;padding:6px 12px;border-radius:12px;cursor:pointer;font-weight:bold;}
#copyStatus{font-size:12px;margin-top:6px;}
.spinner{border:4px solid #ccc;border-top:4px solid #4caf50;border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite;margin-top:6px;display:none;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
button.login-btn{background:#4caf50;color:#fff;border:none;padding:6px 16px;border-radius:12px;cursor:pointer;}
.profile-panel .panel-header {
  background-color: #000; /* solid black */
  border-bottom: 1px solid #222; /* optional, keeps subtle separation */
}
#headerProfile, #panelProfilePic {
  background-image: url('https://i.imgur.com/cM3Givj.jpeg'); /* default */
  background-size: cover;
  background-position: center;
}
/* Disable text selection highlight */
* {
  user-select: none;       /* Prevent selecting text */
  -webkit-user-select: none; 
  -moz-user-select: none;
  -ms-user-select: none;
}

/* Remove input, textarea, button blue outline on focus */
input:focus,
textarea:focus,
button:focus,
select:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* Remove blue tap highlight on mobile */
* {
  -webkit-tap-highlight-color: transparent; 
}

/* Optional: remove link tap highlight */
a:focus, a:active {
  outline: none !important;
}
#panelProfilePic {
  position:relative;
}
#uploadSpinner {
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  display:none;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
#saveHandleBtn {
  padding: 8px 16px;
  border-radius: 12px;
  border: 2px solid #fff; /* white edges */
  background: rgba(0,0,0,0.5); /* glassy black */
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  backdrop-filter: blur(6px); /* glass effect */
  transition: none; /* no hover/movement */
}

#saveHandleBtn:active {
  transform: none; /* no click movement */
}
</style>
<header>
  <img src="https://i.imgur.com/cM3Givj.jpeg" alt="RBX Community" class="logo">
  <div class="header-right">
    <div class="profile" id="headerProfile"></div>
    <div class="hamburger" id="hamburger"><div></div><div></div><div></div></div>
  </div>
</header>

<div class="menu-overlay" id="menuOverlay">
  <a href="#">Home</a>
  <a href="#">Community</a>
  <a href="#">Games</a>
  <a href="#">Events</a>
  <a href="#">Profile</a>
  <a href="#">Settings</a>
</div>

<div class="profile-panel" id="profilePanel">
  <div class="panel-header">
    <img src="https://i.imgur.com/cM3Givj.jpeg" alt="RBX Community" class="profile-logo" style="height:40px; object-fit:contain;">
    <button class="close-btn" id="closeProfile">Close</button>
  </div>
  <div class="panel-top">
    <div id="panelProfilePic"></div>
    <div id="userInfo"></div>
    <div id="copyLinkContainer">
      <input type="text" id="userLink" readonly>
      <button id="copyLinkBtn">Copy</button>
    </div>
    <span id="copyStatus"></span>
    <div class="spinner" id="uploadSpinner"></div>
    <input type="file" id="profileInput" accept="image/*" style="display:none;">
  </div>
<div class="panel-content" style="padding:20px; flex:1; display:flex; flex-direction:column;">
 <!-- Handle / Username Edit -->
<div id="handleContainer" style="display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:12px;">
  <input type="text" id="handleInput" placeholder="Username / Handle" 
         style="padding:6px 12px;border-radius:12px;border:1px solid #333;background:#222;color:#fff;text-align:center;font-size:14px;width:60%;">
 <button id="saveHandleBtn">Save Handle</button>
  <span id="handleStatus" style="font-size:12px;color:#ccc;"></span>
</div>
  <!-- User Stats -->
  <div class="profile-stats" style="display:flex;justify-content:space-around;width:100%;margin-bottom:20px;">
    <div style="text-align:center;">
      <span style="font-weight:bold;font-size:18px;" id="statPosts">0</span>
      <p style="font-size:12px;color:#aaa;margin:0;">Posts</p>
    </div>
    <div style="text-align:center;">
      <span style="font-weight:bold;font-size:18px;" id="statFollowers">0</span>
      <p style="font-size:12px;color:#aaa;margin:0;">Followers</p>
    </div>
    <div style="text-align:center;">
      <span style="font-weight:bold;font-size:18px;" id="statFollowing">0</span>
      <p style="font-size:12px;color:#aaa;margin:0;">Following</p>
    </div>
  </div>


<div style="width:100%;background:#1a1a1a;padding:12px;border-radius:12px;margin-bottom:12px;">
  <h3 style="margin:0 0 8px 0;font-size:16px;">About Me</h3>
  <textarea id="userBioTextarea" maxlength="100" placeholder="Write something about yourself..." 
            style="width:100%;background:#222;color:#ccc;border:none;padding:8px;border-radius:8px;resize:none;font-size:14px;outline:none;"></textarea>
  <div id="bioCharCount" style="text-align:right;font-size:12px;color:#777;margin-top:4px;">0 / 100</div>
  <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
    <button id="saveProfileBtn" style="padding:8px 16px;border-radius:12px;border:none;background:#2196F3;color:#fff;font-weight:bold;cursor:pointer;flex-shrink:0;">Save Profile</button>
    <div class="spinner" id="saveProfileSpinner" style="width:20px;height:20px;border:3px solid #ccc;border-top:3px solid #4caf50;border-radius:50%;animation:spin 1s linear infinite;display:none;"></div>
    <span id="saveProfileStatus" style="font-size:12px;color:#4caf50;"></span>
  </div>
</div>

  </div>
</div>

<main>
  <h1>Main Body Content</h1>
  <p>Scroll down here to test sticky header behavior.</p>
</main>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getDatabase, ref, get, child, set } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
  authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
  databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
  projectId: "itzhoyoo-f9f7e",
  storageBucket: "itzhoyoo-f9f7e.filestorage.app",
  messagingSenderId: "1094792075584",
  appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
  measurementId: "G-LLT6F9WRKH"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Elements (safe)
const hamburger = document.getElementById('hamburger');
const menuOverlay = document.getElementById('menuOverlay');
const headerProfile = document.getElementById('headerProfile');
const profilePanel = document.getElementById('profilePanel');
const closeProfile = document.getElementById('closeProfile');
const panelProfilePic = document.getElementById('panelProfilePic');
const userInfo = document.getElementById('userInfo');
const userLinkInput = document.getElementById('userLink');
const copyBtn = document.getElementById('copyLinkBtn');
const copyStatus = document.getElementById('copyStatus');
const uploadSpinner = document.getElementById('uploadSpinner');
const profileInput = document.getElementById('profileInput');
const userBioTextarea = document.getElementById('userBioTextarea');
const bioCharCount = document.getElementById('bioCharCount');
const statPosts = document.getElementById('statPosts');
const statFollowers = document.getElementById('statFollowers');
const statFollowing = document.getElementById('statFollowing');
const editProfileBtn = document.getElementById('editProfileBtn');
const handleContainer = document.getElementById('handleContainer');
const handleInput = document.getElementById('handleInput');
const saveHandleBtn = document.getElementById('saveHandleBtn');
const handleStatus = document.getElementById('handleStatus');
const changePicBtn = document.getElementById('changePicBtn');
const saveProfileBtn = document.getElementById('saveProfileBtn');
const saveProfileSpinner = document.getElementById('saveProfileSpinner');
const saveProfileStatus = document.getElementById('saveProfileStatus');

// Hamburger toggle
if(hamburger && menuOverlay){
  hamburger.addEventListener('click',()=>{ 
    const isActive = hamburger.classList.toggle('active'); 
    menuOverlay.classList.toggle('active'); 
    document.body.style.overflow = isActive ? 'hidden':'auto';
  });
}

// Profile panel open/close
if(headerProfile && profilePanel){
  headerProfile.addEventListener('click', ()=>{
    profilePanel.classList.add('active'); 
    document.body.style.overflow='hidden';
  });
}
if(closeProfile && profilePanel){
  closeProfile.addEventListener('click', ()=>{
    profilePanel.classList.remove('active'); 
    document.body.style.overflow='auto';
  });
}

// Profile pics rotation
const images = [
  'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRJArE9ejALs7Gadwp7_lPG6ClZ1kGDFBfuqiLeEtkQhQ&s=10',
  'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR5FTSG4Sir8pySUUwqztVtlUAGiDCSia6HzybVbaRRz3yh83Bkro-FLDSw&s=10',
  'https://fiverr.cloudinary.com/images/q_auto,f_auto/gigs/344146044/original/31d16f71c7d233f9f55107e32f77eabde2e83dc7/do-roblox-gfx-profile-pictures.jpeg',
  'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRZJaXc4y8Bmn0dMaS1TOasNx3mbAaAt1vZOHeFWMqPtN6a_bs6dpiT4gI&s=10',
  'https://pbs.twimg.com/media/ESf5MWLWkAEv9Gf.jpg'
];
const loadedImages = [];
images.forEach(src => { 
  const img = new Image(); 
  img.onload = ()=> loadedImages.push(src); 
  img.src = src; 
});
let index = 0; 
let rotationActive = true;
function randomColor(){return `hsl(${Math.floor(Math.random()*360)},80%,60%)`;}
function changeProfile(){
  if(!rotationActive || loadedImages.length===0) return;
  index=(index+1)%loadedImages.length;
  const nextImg=loadedImages[index];
  if(headerProfile) headerProfile.style.opacity='0';
  if(panelProfilePic) panelProfilePic.style.opacity='0';
  setTimeout(()=>{
    if(headerProfile) { headerProfile.style.backgroundImage=`url(${nextImg})`; headerProfile.style.borderColor=randomColor(); headerProfile.style.opacity='1'; }
    if(panelProfilePic) { panelProfilePic.style.backgroundImage=`url(${nextImg})`; panelProfilePic.style.borderColor=randomColor(); panelProfilePic.style.opacity='1'; }
  },300);
}
if(!localStorage.getItem('userCustomPic')) setInterval(changeProfile,5000); else rotationActive=false;

// Copy link
if(copyBtn && userLinkInput){
  copyBtn.addEventListener('click', ()=>{
    if(userLinkInput.value && userLinkInput.value!=="Login to get link"){
      userLinkInput.select();
      navigator.clipboard.writeText(userLinkInput.value).then(()=>{
        if(copyStatus) { copyStatus.textContent='Copied!'; copyStatus.style.color='#4caf50'; }
        setTimeout(()=>{ if(copyStatus) copyStatus.textContent=''; },1500);
      }).catch(err=>{
        if(copyStatus) { copyStatus.textContent='Copy failed!'; copyStatus.style.color='#f44336'; }
        console.error(err);
      });
      window.getSelection().removeAllRanges();
    }
  });
}

// Profile picture update
if(panelProfilePic && profileInput){
  panelProfilePic.addEventListener('click',()=> profileInput.click());
}
if(changePicBtn && profileInput){
  changePicBtn.addEventListener('click',()=> profileInput.click());
}
if(profileInput){
  profileInput.addEventListener('change', async ()=>{
    if(!profileInput.files[0]) return;
    const file = profileInput.files[0];
    if(uploadSpinner) uploadSpinner.style.display='block';
    const formData = new FormData();
    formData.append('image', file);
    try{
      const res = await fetch('https://api.imgur.com/3/image', {
        method:'POST', headers:{Authorization:'Client-ID 891e5bb4aa94282'}, body: formData
      });
      const data = await res.json();
      if(data.success){
        const imgUrl = data.data.link;
        const user = auth.currentUser;
        if(user){
          await set(ref(db, `users/${user.uid}/profilePic`), imgUrl);
          if(panelProfilePic) panelProfilePic.style.backgroundImage=`url(${imgUrl})`;
          if(headerProfile) headerProfile.style.backgroundImage=`url(${imgUrl})`;
          rotationActive=false;
          localStorage.setItem('userCustomPic','true');
        }
      } else alert('Upload failed');
    }catch(err){console.error(err); alert('Upload error');}
    if(uploadSpinner) uploadSpinner.style.display='none';
  });
}

// Load user data
onAuthStateChanged(auth,user=>{
  if(userInfo) userInfo.innerHTML='';
  if(userLinkInput) userLinkInput.value='';
  if(user){
    const uid=user.uid;
    if(userLinkInput) userLinkInput.value=`${window.location.origin}/profile?useruid=${uid}`;
    get(child(ref(db), `users/${uid}`)).then(snapshot=>{
      const data = snapshot.exists()? snapshot.val() : {};
      // Profile pic
      if(data.profilePic){
        if(panelProfilePic) panelProfilePic.style.backgroundImage=`url(${data.profilePic})`;
        if(headerProfile) headerProfile.style.backgroundImage=`url(${data.profilePic})`;
        rotationActive=false;
      }
      // Handle
      const handle=data.handle||user.displayName||"User";
      const followersCount=data.followers||0;
      const verified = followersCount>=1000;
      if(userInfo){
        userInfo.innerHTML=`@${handle} (${followersCount})`;
        if(verified){
          const badge = document.createElement('img'); 
          badge.src='https://static.vecteezy.com/system/resources/thumbnails/047/309/918/small_2x/verified-badge-profile-icon-png.png'; 
          badge.style.width='18px'; badge.style.height='18px';
          userInfo.appendChild(badge);
        }
      }
      // Stats
      if(statPosts) statPosts.textContent=data.posts||0;
      if(statFollowers) statFollowers.textContent=data.followers||0;
      if(statFollowing) statFollowing.textContent=data.following||0;
      // Bio
      if(userBioTextarea) {
        userBioTextarea.value=data.bio||'';
        if(bioCharCount) bioCharCount.textContent=`${userBioTextarea.value.length} / 100`;
      }
      if(handleInput) handleInput.value=handle;
    });
  }else{
    if(userLinkInput) userLinkInput.value="Login to get link";
    if(userInfo){
      const btn=document.createElement('button'); 
      btn.textContent='LOGIN / REGISTER'; 
      btn.classList.add('login-btn');
      userInfo.appendChild(btn);
    }
  }
});


// Edit handle
if(editProfileBtn && handleContainer && handleInput){
  editProfileBtn.addEventListener('click', async ()=>{
    const user=auth.currentUser; if(!user) return alert("Login first!");
    handleContainer.style.display='flex'; handleInput.focus();
  });
}

// Save handle
if(saveHandleBtn && handleInput && handleStatus && userInfo){
  saveHandleBtn.addEventListener('click', async ()=>{
    const user = auth.currentUser; if(!user) return alert("Login first!");
    const newHandle = handleInput.value.trim();
    if(newHandle.length<3) return alert("Handle too short!");
    await set(ref(db, `users/${user.uid}/handle`), newHandle);
    handleStatus.textContent="Handle saved!"; handleStatus.style.color="#4caf50";
    const followers=(await get(ref(db, `users/${user.uid}/followers`))).val()||0;
    const verified = followers>=1000;
    userInfo.innerHTML=`@${newHandle} (${followers})`;
    if(verified){const badge=document.createElement('img'); badge.src='https://static.vecteezy.com/system/resources/thumbnails/047/309/918/small_2x/verified-badge-profile-icon-png.png'; badge.style.width='18px'; badge.style.height='18px'; userInfo.appendChild(badge);}
    setTimeout(()=>{handleStatus.textContent='';},2000);
  });
}

// Save profile (bio + handle)
if(saveProfileBtn){
  saveProfileBtn.addEventListener('click', async () => {
    const user = auth.currentUser;
    if(!user) return alert("Please log in first!");
    if(saveProfileSpinner) saveProfileSpinner.style.display = 'block';
    if(saveProfileStatus) saveProfileStatus.textContent = '';
    try{
      if(userBioTextarea) await set(ref(db, `users/${user.uid}/bio`), userBioTextarea.value);
      if(handleInput && handleInput.value.trim().length >= 3){
        await set(ref(db, `users/${user.uid}/handle`), handleInput.value.trim());
      }
      if(saveProfileStatus) { saveProfileStatus.textContent = 'Saved!'; saveProfileStatus.style.color = '#4caf50'; }
    }catch(err){
      console.error(err);
      if(saveProfileStatus){ saveProfileStatus.textContent = 'Save failed!'; saveProfileStatus.style.color = '#f44336'; }
    }finally{
      if(saveProfileSpinner) saveProfileSpinner.style.display = 'none';
      setTimeout(()=>{if(saveProfileStatus) saveProfileStatus.textContent='';},2000);
    }
  });
}
</script>
</body>
</html>