<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile | RBX Community</title>
    <style>
        :root { --accent: #0A84FF; }
        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 20px; text-align: center; }
        .back-btn { background: none; color: var(--accent); border: none; cursor: pointer; float: left; }
        
        .profile-container { margin-top: 50px; }
        .pfp { 
            width: 110px; height: 110px; border-radius: 50%; 
            border: 1.5px solid rgba(255,255,255,0.9); 
            margin: 0 auto; background-size: cover; background-position: center;
            background-color: #111;
        }
        .handle { font-size: 22px; font-weight: 800; margin-top: 15px; }
        .bio { color: #888; font-size: 14px; margin-top: 5px; }
        
        #loading-overlay {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div id="loading-overlay">Loading...</div>

    <button class="back-btn" onclick="window.history.back()">‚Üê Back</button>

    <div class="profile-container">
        <div id="uPfp" class="pfp"></div>
        <div id="uHandle" class="handle">@username</div>
        <div id="uBio" class="bio">RBX Community Member</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        const config = {
            apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
            authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
            databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
            projectId: "itzhoyoo-f9f7e",
            appId: "1:1094792075584:web:d49e9cd31082a5"
        };

        const app = initializeApp(config);
        const db = getDatabase(app);

        // BULLETPROOF UID DETECTION
        const getUID = () => {
            const params = new URLSearchParams(window.location.search);
            let uid = params.get('user');
            if(!uid) {
                // Backup check if Vercel strips the query key
                uid = window.location.href.split('user=')[1];
            }
            return uid;
        };

        const targetUid = getUID();

        async function loadProfile() {
            if (!targetUid) {
                document.getElementById('uHandle').innerText = "User ID Missing";
                document.getElementById('loading-overlay').style.display = 'none';
                return;
            }

            try {
                // Fetching from your 'users' node
                const userRef = ref(db, 'users/' + targetUid);
                const snapshot = await get(userRef);

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    
                    // Set Data
                    document.getElementById('uHandle').innerText = "@" + data.handle;
                    
                    if (data.profilePic) {
                        document.getElementById('uPfp').style.backgroundImage = `url('${data.profilePic}')`;
                    }
                    
                    // Hide loader
                    document.getElementById('loading-overlay').style.opacity = '0';
                    setTimeout(() => document.getElementById('loading-overlay').remove(), 500);
                    
                } else {
                    document.getElementById('uHandle').innerText = "User Not Found";
                    document.getElementById('loading-overlay').innerText = "Error: User ID not in Database";
                }
            } catch (err) {
                console.error(err);
                document.getElementById('loading-overlay').innerText = "Connection Error";
            }
        }

        loadProfile();
    </script>
</body>
</html>
