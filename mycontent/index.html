<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Studio Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #000; --card: #111; --accent: #00E052; --border: #fff; --text-dim: #444; --red: #ff453a; --blue: #007aff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; }

        #loader { position: fixed; inset: 0; background: #000; z-index: 20000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .spinner { width: 35px; height: 35px; border: 3px solid #111; border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .app-container { width: 100%; max-width: 450px; padding: 20px; padding-bottom: 120px; margin: 0 auto; }
        
        /* Stats Styling */
        .rev-card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 12px; text-align: center; }
        .chart-container { background: #080808; border-radius: 24px; padding: 15px; border: 1px solid #1a1a1a; margin: 15px 0; }
        
        /* Engagement Pulse (Subtle - No White Edges) */
        .pulse-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px; }
        .pulse-box { background: #111; border: 1px solid #222; border-radius: 12px; padding: 10px; text-align: center; }
        .pulse-val { display: block; font-size: 14px; font-weight: 800; color: #fff; }
        .pulse-lab { font-size: 7px; color: var(--text-dim); font-weight: 900; }

        /* Navigation */
        .main-nav { display: flex; background: #111; border: 1px solid var(--border); border-radius: 20px; padding: 5px; margin-bottom: 25px; }
        .nav-tab { flex: 1; padding: 12px; border: none; background: none; color: var(--text-dim); font-size: 10px; font-weight: 800; border-radius: 15px; }
        .nav-tab.active { background: #fff; color: #000; }

        /* Items */
        .item-card { background: #111; border: 1px solid #222; border-radius: 20px; padding: 15px; margin-bottom: 12px; }
        .item-img { width: 100%; height: 160px; border-radius: 12px; object-fit: cover; margin-bottom: 10px; }
        .full-btn { width: 100%; padding: 14px; border-radius: 25px; border: none; font-weight: 800; font-size: 11px; margin-top: 10px; }
    </style>
</head>
<body>

<div id="loader"><div class="spinner"></div></div>

<div class="app-container">
    <div class="main-nav">
        <button class="nav-tab active" onclick="tab('stats')">ANALYSIS</button>
        <button class="nav-tab" onclick="tab('manage')">CONTENT</button>
        <button class="nav-tab" onclick="tab('pay')">PAYMENT</button>
    </div>

    <section id="sec-stats">
        <div class="rev-card">
            <small style="font-size: 9px; color: var(--accent); font-weight: 800;">TOTAL REVENUE</small>
            <div id="bal-total" style="font-size: 42px; font-weight: 900; margin: 5px 0;">$0.00</div>
            <div style="display: flex; justify-content: space-between; font-size: 10px; margin-top: 10px;">
                <span>CPM: <b id="cpm-val">$0.00</b></span>
                <span>CLICKS: <b id="v-clicks">0</b></span>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="proChart"></canvas>
        </div>

        <div class="pulse-grid">
            <div class="pulse-box"><span class="pulse-val" id="p-views">0</span><span class="pulse-lab">VIEWS</span></div>
            <div class="pulse-box"><span class="pulse-val" id="p-likes">0</span><span class="pulse-lab">LIKES</span></div>
            <div class="pulse-box"><span class="pulse-val" id="p-fans">0</span><span class="pulse-lab">FANS</span></div>
            <div class="pulse-box"><span class="pulse-val" id="p-coms">0</span><span class="pulse-lab">COMS</span></div>
        </div>
    </section>

    <section id="sec-manage" style="display:none;">
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button class="nav-tab active" id="sub-post" onclick="sub('post')">POSTS</button>
            <button class="nav-tab" id="sub-story" onclick="sub('story')">STORIES</button>
            <button class="nav-tab" id="sub-poll" onclick="sub('poll')">POLLS</button>
        </div>
        <div id="list"></div>
    </section>

    <section id="sec-pay" style="display:none; text-align: center;">
        <input type="email" id="pp-input" placeholder="PayPal Email" style="width:100%; padding:15px; border-radius:15px; background:#111; border:1px solid #fff; color:#fff; text-align:center;">
        <button onclick="savePay()" class="full-btn" style="background:#fff; color:#000;">SAVE ACCOUNT</button>
    </section>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getDatabase, ref, get, update, remove, set } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

    const config = { apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo", databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com", projectId: "itzhoyoo-f9f7e" };
    const app = initializeApp(config); const db = getDatabase(app); const auth = getAuth(app);
    let myChart, curType = 'post';

    const getDates = () => {
        const d = []; for(let i=6; i>=0; i--) {
            const date = new Date(); date.setDate(date.getDate() - i);
            d.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        } return d;
    };

    function initChart(v, c, r) {
        const ctx = document.getElementById('proChart').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: getDates(),
                datasets: [
                    { label: 'Views', data: [v*0.1, v*0.3, v*0.2, v*0.5, v*0.4, v*0.8, v], borderColor: '#007aff', borderWidth: 2, tension: 0.4, pointRadius: 0 },
                    { label: 'Clicks', data: [c*0.1, c*0.2, c*0.4, c*0.3, c*0.6, c*0.5, c], borderColor: '#ff453a', borderWidth: 2, tension: 0.4, pointRadius: 0 },
                    { label: 'Rev', data: [r*0.1, r*0.4, r*0.2, r*0.6, r*0.5, r*0.9, r], borderColor: '#00E052', borderWidth: 2, tension: 0.4, pointRadius: 0 }
                ]
            },
            options: { plugins: { legend: { display: false } }, scales: { x: { grid: { display: false }, ticks: { color: '#333', font: { size: 8 } } }, y: { display: false } } }
        });
    }

    async function runStats() {
        const u = auth.currentUser; if(!u) return;
        let v=0, l=0, f=0, c=0, clicks=0;
        const types = ['post', 'story', 'poll'];
        for(let t of types){
            const snap = await get(ref(db, t));
            if(snap.exists()){
                Object.values(snap.val()).forEach(item => {
                    if(item.uid === u.uid){
                        v += (item.views || 0);
                        l += item.likes ? Object.keys(item.likes).length : 0;
                        c += item.comments ? Object.keys(item.comments).length : 0;
                        if(item.sponsored) clicks += Math.floor((item.views || 0) * 0.022);
                    }
                });
            }
        }
        const fans = await get(ref(db, `followers/${u.uid}`));
        f = fans.exists() ? Object.keys(fans.val()).length : 0;

        const rev = (v/1000)*2.5 + (clicks*0.12);
        const cpm = v > 0 ? (rev/v)*1000 : 0;

        document.getElementById('bal-total').innerText = `$${rev.toFixed(2)}`;
        document.getElementById('cpm-val').innerText = `$${cpm.toFixed(2)}`;
        document.getElementById('v-clicks').innerText = clicks;
        document.getElementById('p-views').innerText = v;
        document.getElementById('p-likes').innerText = l;
        document.getElementById('p-fans').innerText = f;
        document.getElementById('p-coms').innerText = c;
        initChart(v, clicks, rev);
    }

    window.tab = (id) => {
        document.querySelectorAll('section').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.main-nav .nav-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('sec-'+id).style.display = 'block';
        event.currentTarget.classList.add('active');
        if(id === 'manage') loadContent(); else if(id === 'stats') runStats();
    };

    window.sub = (t) => {
        curType = t; document.querySelectorAll('#sec-manage button').forEach(b => b.classList.remove('active'));
        document.getElementById('sub-'+t).classList.add('active'); loadContent();
    };

    window.loadContent = async () => {
        const list = document.getElementById('list'); list.innerHTML = "";
        const s = await get(ref(db, curType));
        let count = 0;
        if(s.exists()){
            Object.entries(s.val()).forEach(([id, item]) => {
                if(item.uid === auth.currentUser.uid){
                    count++;
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.innerHTML = `
                        ${curType !== 'poll' && item.image ? `<img src="${item.image}" class="item-img">` : ''}
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <b style="font-size:13px;">${item.title || item.question || 'Untitled'}</b>
                            <button onclick="del('${id}')" style="background:none; border:none; color:var(--red); font-size:9px; font-weight:800;">DELETE</button>
                        </div>
                        <div style="font-size:9px; color:#444; margin-top:5px;">üëÅÔ∏è ${item.views || 0}  ‚ù§Ô∏è ${item.likes ? Object.keys(item.likes).length : 0}</div>
                        ${curType !== 'poll' ? `<button onclick="mon('${id}', ${item.sponsored})" class="full-btn" style="background:${item.sponsored?'var(--accent)':'#222'}; color:${item.sponsored?'#000':'#fff'}">${item.sponsored ? 'MONETIZED' : 'ACTIVATE REVENUE'}</button>` : ''}
                    `;
                    list.appendChild(card);
                }
            });
        }
        if(count === 0) list.innerHTML = `<div class="empty-msg">No ${curType}s found yet.</div>`;
    };

    window.savePay = async () => {
        const email = document.getElementById('pp-input').value;
        if(email.includes('@')) { await set(ref(db, `paymentmethods/${auth.currentUser.uid}`), { email }); alert("Saved"); }
    };

    onAuthStateChanged(auth, async u => { if(u) {
        await runStats();
        const ps = await get(ref(db, `paymentmethods/${u.uid}`));
        if(ps.exists()) document.getElementById('pp-input').value = ps.val().email;
        setTimeout(() => { document.getElementById('loader').style.opacity = '0'; setTimeout(() => document.getElementById('loader').style.display = 'none', 500); }, 1500);
    }});
</script>
</body>
</html>
