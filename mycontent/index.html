<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RBX Creator Studio</title>
    <style>
        :root {
            --bg: #000000;
            --card: #1C1C1E;
            --accent: #00E052;
            --text-dim: #8E8E93;
            --border: #333333;
            --red: #FF453A;
        }
        body { background: var(--bg); color: #fff; font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding-bottom: 100px; }
        
        header { padding: 40px 20px 20px; }
        .view-title { font-size: 34px; font-weight: 800; margin: 0; }
        .view-subtitle { color: var(--text-dim); font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        .mgmt-section { display: none; padding: 0 20px; animation: fadeIn 0.3s ease; }
        .active { display: block; }

        /* Analysis Cards */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .balance-card { grid-column: span 2; background: var(--accent); padding: 25px; border-radius: 20px; color: #000; position: relative; overflow: hidden; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 8px; }
        .stat-label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; font-weight: 900; display: flex; align-items: center; gap: 6px; }
        .stat-val { font-size: 22px; font-weight: 900; }
        
        /* Content List */
        .content-card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 12px; border: 1px solid var(--border); display: flex; align-items: center; gap: 15px; }
        .content-thumb { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; background: #222; }
        .monetize-btn { border: none; padding: 10px 16px; border-radius: 12px; font-weight: 800; font-size: 11px; cursor: pointer; transition: 0.2s; }

        /* Navigation */
        nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: rgba(28,28,30,0.8); backdrop-filter: blur(20px); display: flex; border-top: 0.5px solid var(--border); z-index: 1000; }
        .nav-btn { flex: 1; background: none; border: none; color: var(--text-dim); font-weight: 800; font-size: 10px; letter-spacing: 1px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .nav-btn.active { color: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        svg { width: 18px; height: 18px; }
    </style>
</head>
<body>

<header>
    <div class="view-subtitle" id="view-type">Studio</div>
    <h1 class="view-title" id="main-title">Content</h1>
</header>

<section id="view-analysis" class="mgmt-section">
    <div class="balance-card">
        <div class="stat-label" style="color: #000; opacity: 0.6;">Available Balance</div>
        <div class="stat-val" id="balance" style="font-size: 42px;">$0.00</div>
        <svg style="position:absolute; right: -10px; bottom: -10px; width: 100px; height: 100px; opacity: 0.1;" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17V15H12V13H10A2,2 0 0,1 8,11V9A2,2 0 0,1 10,7H14V9H13V11H15A2,2 0 0,1 17,13V15A2,2 0 0,1 15,17H11Z"/></svg>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg> Valid Clicks</span>
            <span class="stat-val" id="valid-clicks" style="color: var(--accent);">0</span>
        </div>
        <div class="stat-card">
            <span class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> Invalid</span>
            <span class="stat-val" id="invalid-clicks" style="color: var(--red);">0</span>
        </div>
        <div class="stat-card">
            <span class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 6l-9.5 9.5-5-5L1 18"></path><polyline points="17 6 23 6 23 12"></polyline></svg> Dynamic CPM</span>
            <span class="stat-val" id="dynamic-cpm">$0.00</span>
        </div>
        <div class="stat-card">
            <span class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg> Ad Revenue</span>
            <span class="stat-val" id="click-revenue">$0.00</span>
        </div>
    </div>
</section>

<section id="view-content" class="mgmt-section active">
    <div id="content-list"></div>
</section>

<nav>
    <button class="nav-btn active" id="btn-content" onclick="switchTab('content')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
        CONTENT
    </button>
    <button class="nav-btn" id="btn-analysis" onclick="switchTab('analysis')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
        ANALYSIS
    </button>
</nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getDatabase, ref, get, update, set, push } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

    // Re-use your existing Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
        authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
        databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
        projectId: "itzhoyoo-f9f7e",
        storageBucket: "itzhoyoo-f9f7e.filestorage.app",
        messagingSenderId: "1094792075584",
        appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentUser = null;

    window.switchTab = (tab) => {
        document.querySelectorAll('.mgmt-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`view-${tab}`).classList.add('active');
        document.getElementById(`btn-${tab}`).classList.add('active');
        document.getElementById('main-title').innerText = tab.charAt(0).toUpperCase() + tab.slice(1);
        
        if (tab === 'analysis') runAnalysis();
    };

    async function loadMyContent() {
        const list = document.getElementById('content-list');
        list.innerHTML = "";
        const types = ['post', 'poll', 'story'];
        
        for (const type of types) {
            const snap = await get(ref(db, type));
            if (!snap.exists()) continue;
            
            Object.entries(snap.val()).forEach(([id, item]) => {
                if (item.uid === auth.currentUser.uid) {
                    const isMon = item.sponsored === true;
                    const card = document.createElement('div');
                    card.className = 'content-card';
                    card.innerHTML = `
                        <img src="${item.image || 'https://via.placeholder.com/60'}" class="content-thumb">
                        <div style="flex:1;">
                            <div style="font-size:14px; font-weight:800;">${(item.title || item.question || 'Untitled').substring(0,20)}</div>
                            <div style="font-size:10px; color:var(--text-dim);">${type.toUpperCase()} â€¢ ${item.views || 0} VIEWS</div>
                        </div>
                        <button class="monetize-btn" id="monBtn-${id}" 
                            style="background:${isMon ? 'var(--accent)' : '#333'}; color:${isMon ? '#000' : '#888'};">
                            ${isMon ? 'MONETIZED' : 'MONETIZE'}
                        </button>
                    `;
                    list.appendChild(card);
                    
                    card.querySelector(`#monBtn-${id}`).onclick = () => toggleMonetize(type, id, isMon);
                }
            });
        }
    }

    async function toggleMonetize(type, id, current) {
        const itemRef = ref(db, `${type}/${id}`);
        if (!current) {
            const url = prompt("Enter Sponsored Link (https://):");
            if (url && url.startsWith('http')) {
                await update(itemRef, { sponsored: true, link: url });
                loadMyContent();
            }
        } else {
            if (confirm("Remove monetization?")) {
                await update(itemRef, { sponsored: null, link: null });
                loadMyContent();
            }
        }
    }

    async function runAnalysis() {
        if (!auth.currentUser) return;
        const uid = auth.currentUser.uid;
        
        let valid = 0, invalid = 0, views = 0;
        const types = ['post', 'poll', 'story'];
        const userItems = [];

        for (const type of types) {
            const snap = await get(ref(db, type));
            if (snap.exists()) {
                Object.entries(snap.val()).forEach(([id, item]) => {
                    if (item.uid === uid && item.sponsored) {
                        userItems.push(id);
                        views += (item.views || 0);
                    }
                });
            }
        }

        for (const id of userItems) {
            const cSnap = await get(ref(db, `clicks/${id}`));
            if (cSnap.exists()) {
                Object.values(cSnap.val()).forEach(c => {
                    if (c.valid) valid++; else invalid++;
                });
            }
        }

        const dynamicCPM = 2.50 + (valid * 0.02);
        const revenue = (valid * 0.15) + ((views / 1000) * dynamicCPM);

        document.getElementById('valid-clicks').innerText = valid;
        document.getElementById('invalid-clicks').innerText = invalid;
        document.getElementById('dynamic-cpm').innerText = `$${dynamicCPM.toFixed(2)}`;
        document.getElementById('click-revenue').innerText = `$${(valid * 0.15).toFixed(2)}`;
        document.getElementById('balance').innerText = `$${revenue.toFixed(2)}`;
    }

    onAuthStateChanged(auth, user => {
        if (user) {
            loadMyContent();
        } else {
            window.location.href = "/login";
        }
    });
</script>
</body>
</html>
