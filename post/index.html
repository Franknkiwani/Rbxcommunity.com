<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>View Post | RBX</title>
    <style>
        :root { --accent: #0095f6; --bg: #000; --card: #111; --border: #262626; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; }
        .nav { height: 50px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 15px; position: sticky; top: 0; background: #000; z-index: 10; }
        .back-btn { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; padding-right: 20px; }
        .post-container { max-width: 600px; margin: 0 auto; }
        .post-header { display: flex; align-items: center; padding: 12px; }
        .user-pfp { width: 32px; height: 32px; border-radius: 50%; background: #222; margin-right: 10px; border: 1px solid var(--border); background-size: cover; }
        .user-handle { font-weight: 600; font-size: 14px; color: #fff; text-decoration: none; }
        .post-media img { width: 100%; display: block; background: #111; }
        .post-details { padding: 12px; }
        #loading-overlay { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 100; }
    </style>
</head>
<body>

    <div id="loading-overlay">Loading Post...</div>

    <nav class="nav">
        <button class="back-btn" onclick="window.location.href='/'">‚Üê</button>
        <span style="font-weight:700">Post</span>
    </nav>

    <div class="post-container">
        <div class="post-header">
            <div id="authorPfp" class="user-pfp"></div>
            <a href="#" id="authorHandle" class="user-handle">@loading</a>
        </div>
        <div class="post-media">
            <img id="postImg" src="">
        </div>
        <div class="post-details">
            <div class="caption"><b id="capHandle">user</b> <span id="capText">...</span></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        const config = {
            apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
            authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
            databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
            projectId: "itzhoyoo-f9f7e",
            appId: "1:1094792075584:web:d49e9cd31082a5"
        };

        const app = initializeApp(config);
        const db = getDatabase(app);

        // --- THE FIX FOR DYNAMIC URLS ---
        // This takes "/post/-Oh-NIj..." and grabs the "-Oh-NIj..." part
        const pathArray = window.location.pathname.split('/');
        const postId = pathArray[pathArray.length - 1];

        if (!postId || postId === "post") {
            document.body.innerHTML = "<div style='padding:50px; text-align:center'>Invalid Post ID</div>";
        } else {
            // Use 'post' (singular) as requested
            onValue(ref(db, `post/${postId}`), (snap) => {
                const data = snap.val();
                if (!data) {
                    document.getElementById('loading-overlay').innerText = "Post Not Found";
                    return;
                }

                document.getElementById('postImg').src = data.image || data.url;
                document.getElementById('capText').innerText = data.caption || "";

                // Fetch User Info
                onValue(ref(db, `users/${data.uid}`), (uSnap) => {
                    const u = uSnap.val() || {};
                    document.getElementById('authorHandle').innerText = `@${u.handle || 'user'}`;
                    document.getElementById('capHandle').innerText = u.handle || 'user';
                    if (u.profilePic) document.getElementById('authorPfp').style.backgroundImage = `url('${u.profilePic}')`;
                });

                document.getElementById('loading-overlay').style.display = 'none';
            });
        }
    </script>
</body>
</html>
