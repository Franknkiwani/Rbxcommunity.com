<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>User Profile</title>
    <link rel="stylesheet" href="style.css"> <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; }
        .profile-header { text-align: center; padding: 40px 20px; border-bottom: 1px solid #222; }
        .profile-pfp { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; background-size: cover; background-position: center; border: 2px solid #333; }
        .profile-handle { font-size: 20px; font-weight: 900; margin: 0; }
        .profile-bio { color: #aaa; font-size: 14px; margin: 10px auto; max-width: 400px; line-height: 1.4; }
        
        .tab-bar { display: flex; justify-content: space-around; border-bottom: 1px solid #222; position: sticky; top: 0; background: rgba(0,0,0,0.9); z-index: 10; }
        .tab { padding: 15px; font-size: 12px; font-weight: bold; color: #555; cursor: pointer; text-transform: uppercase; }
        .tab.active { color: #fff; border-bottom: 2px solid #fff; }

        .content-section { display: none; padding: 10px; }
        .content-section.active { display: block; }

        /* Grid for Posts/Stories */
        .media-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; }
        .grid-item { aspect-ratio: 1/1; background-size: cover; background-position: center; background-color: #111; cursor: pointer; }
        
        /* List for Polls */
        .poll-list { display: flex; flex-direction: column; gap: 15px; max-width: 500px; margin: 0 auto; }
        
        .back-btn { position: fixed; top: 20px; left: 20px; background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 15px; border-radius: 20px; cursor: pointer; z-index: 100; }
    </style>
</head>
<body>

    <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Home</button>

    <div class="profile-header">
        <div id="targetPfp" class="profile-pfp"></div>
        <h1 id="targetHandle" class="profile-handle">Loading...</h1>
        <p id="targetBio" class="profile-bio"></p>
        <button id="profileFollowBtn" style="display:none; background:#fff; color:#000; border:none; padding:8px 25px; border-radius:20px; font-weight:bold;"></button>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="switchTab('posts', this)">Posts</div>
        <div class="tab" onclick="switchTab('polls', this)">Polls</div>
        <div class="tab" onclick="switchTab('stories', this)">Stories</div>
    </div>

    <div id="postsSection" class="content-section active">
        <div id="postsGrid" class="media-grid"></div>
    </div>

    <div id="pollsSection" class="content-section">
        <div id="pollsList" class="poll-list"></div>
    </div>

    <div id="storiesSection" class="content-section">
        <div id="storiesGrid" class="media-grid"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

        // 1. YOUR CONFIG HERE
        const firebaseConfig = { /* PASTE YOUR CONFIG OBJECT HERE */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // 2. GET UID FROM URL
        const params = new URLSearchParams(window.location.search);
        const targetUid = params.get('id');

        if (!targetUid) window.location.href = 'index.html';

        window.switchTab = (sectionId, el) => {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(sectionId + 'Section').classList.add('active');
            el.classList.add('active');
        };

        // 3. FETCH DATA
        async function loadProfile() {
            // A. Fetch User Info
            const userSnap = await get(ref(db, `users/${targetUid}`));
            const user = userSnap.val();
            if (user) {
                document.getElementById('targetPfp').style.backgroundImage = `url(${user.profilePic || 'default.png'})`;
                document.getElementById('targetHandle').innerText = `@${(user.handle || 'user').toLowerCase()}`;
                document.getElementById('targetBio').innerText = user.bio || "";
            }

            // B. Fetch Posts (Filtering by UID)
            const postsSnap = await get(query(ref(db, 'posts'), orderByChild('uid'), equalTo(targetUid)));
            const postsGrid = document.getElementById('postsGrid');
            if (postsSnap.exists()) {
                Object.values(postsSnap.val()).reverse().forEach(post => {
                    const item = document.createElement('div');
                    item.className = 'grid-item';
                    item.style.backgroundImage = `url(${post.imageUrl})`;
                    postsGrid.appendChild(item);
                });
            }

            // C. Fetch Polls
            const pollsSnap = await get(query(ref(db, 'polls'), orderByChild('uid'), equalTo(targetUid)));
            const pollsList = document.getElementById('pollsList');
            if (pollsSnap.exists()) {
                Object.values(pollsSnap.val()).forEach(poll => {
                    const p = document.createElement('div');
                    p.innerHTML = `<div style="background:#111; padding:15px; border-radius:10px;">
                        <p style="font-weight:bold; margin-bottom:10px;">${poll.question}</p>
                        <div style="font-size:12px; color:#555;">Poll by User</div>
                    </div>`;
                    pollsList.appendChild(p);
                });
            }

            // D. Fetch Stories
            const storiesSnap = await get(query(ref(db, 'stories'), orderByChild('uid'), equalTo(targetUid)));
            const storiesGrid = document.getElementById('storiesGrid');
            if (storiesSnap.exists()) {
                Object.values(storiesSnap.val()).forEach(story => {
                    const item = document.createElement('div');
                    item.className = 'grid-item';
                    item.style.backgroundImage = `url(${story.imageUrl})`;
                    storiesGrid.appendChild(item);
                });
            }
        }

        loadProfile();
    </script>
</body>
</html>
