<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile | RBX</title>
    <style>
        body { background: #000; color: #fff; font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 0; display: flex; justify-content: center; }
        .profile-container { width: 100%; max-width: 400px; padding: 40px 20px; text-align: center; }
        
        /* Matching your main app style */
        #uPfp { 
            width: 120px; height: 120px; border-radius: 50%; 
            border: 2px solid #fff; margin: 0 auto 20px;
            background-size: cover; background-position: center;
            background-color: #111; box-shadow: 0 10px 30px rgba(255,255,255,0.1);
        }
        #uHandle { font-size: 26px; font-weight: 900; letter-spacing: -1px; text-transform: lowercase; }
        #uBio { color: #888; margin-top: 10px; font-size: 14px; line-height: 1.5; padding: 0 20px; }
        .back-btn { position: absolute; top: 20px; left: 20px; background: #222; border: none; color: #fff; padding: 8px 15px; border-radius: 10px; font-weight: 800; cursor: pointer; }
        #loader { font-weight: 900; opacity: 0.5; margin-top: 50px; }
    </style>
</head>
<body>

    <button class="back-btn" onclick="window.history.back()">‚Üê BACK</button>

    <div class="profile-container">
        <div id="loader">LOADING PROFILE...</div>
        <div id="profile-content" style="display:none;">
            <div id="uPfp"></div>
            <div id="uHandle"></div>
            <div id="uBio"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        // Your specific project config
        const firebaseConfig = {
            apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
            authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
            databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
            projectId: "itzhoyoo-f9f7e",
            appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // EXTRA ROBUST UID PARSER
        const getTargetUID = () => {
            const urlParams = new URLSearchParams(window.location.search);
            let uid = urlParams.get('user');
            
            // If URLSearchParams fails, try manual split
            if (!uid) {
                const parts = window.location.href.split('user=');
                if (parts.length > 1) uid = parts[1].split('&')[0];
            }
            return uid;
        };

        async function loadProfile() {
            const uid = getTargetUID();
            const loader = document.getElementById('loader');
            const content = document.getElementById('profile-content');

            if (!uid) {
                loader.innerText = "ERROR: NO USER ID FOUND";
                return;
            }

            try {
                // Target the exact path where your signup saves data
                const userRef = ref(db, 'users/' + uid);
                const snapshot = await get(userRef);

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    
                    // Update the DOM
                    document.getElementById('uHandle').innerText = "@" + (data.handle || "user");
                    document.getElementById('uBio').innerText = data.bio || "No bio yet.";
                    
                    if (data.profilePic) {
                        document.getElementById('uPfp').style.backgroundImage = `url('${data.profilePic}')`;
                    }

                    loader.style.display = 'none';
                    content.style.display = 'block';
                } else {
                    loader.innerText = "USER NOT FOUND";
                }
            } catch (err) {
                console.error(err);
                loader.innerText = "CONNECTION ERROR";
            }
        }

        loadProfile();
    </script>
</body>
</html>
